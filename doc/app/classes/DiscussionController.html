<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: DiscussionController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">DiscussionController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/discussion_controller_rb.html">
                app/controllers/discussion_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This controller manages the discussion forum.
</p>
<p>
Both the Gallery and the Discussion utilize the same underlying
classes(models): topics and posts. In the Discussion controller, posts and
topics work pretty much how you would expect in a forum. Discussion acts as
a single forum. It can have multiple topics and each topic has multiple
posts.
</p>
<p>
Much of this and topics and posts are brought over from Beast
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000108">assign_protected</a>&nbsp;&nbsp;
      <a href="#M000111">block_locked</a>&nbsp;&nbsp;
      <a href="#M000105">create</a>&nbsp;&nbsp;
      <a href="#M000107">destroy</a>&nbsp;&nbsp;
      <a href="#M000109">find_forum_and_topic</a>&nbsp;&nbsp;
      <a href="#M000102">index</a>&nbsp;&nbsp;
      <a href="#M000103">new</a>&nbsp;&nbsp;
      <a href="#M000110">redirect_if_not_right_topic</a>&nbsp;&nbsp;
      <a href="#M000104">show</a>&nbsp;&nbsp;
      <a href="#M000106">update</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Actually creates the <a href="DiscussionController.html#M000103">new</a>
topic. In the <a href="DiscussionController.html#M000103">new</a> topic
page, theere is a drop down menu for which section the topic should be made
for. Each topic has a section associated with it so as to limit visibility
of the topics based on sections which is in turn based on courses. If that
section to make a topic for comes back as -1, then a <a
href="DiscussionController.html#M000103">new</a> topic will be made for all
sections of the semester. This is performed in the first part of the
function. If the section is not -1, then a topic is only created for one
specific section.
</p>
<p>
A topic only has a title, it also requires that a post be created at the
same time which contains the content of the topic. That is why the
transaction is used, so that the topic is created only if the post is a
valid one.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 52</span>
 52:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>  
 53:     <span class="ruby-identifier">cur_section_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;section_id&quot;</span>)
 54:     <span class="ruby-comment cmt">#This is a hack so that it will create a new topic for all sections</span>
 55:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cur_section_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">-1</span>
 56:       <span class="ruby-identifier">sections</span> = <span class="ruby-ivar">@semester</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)
 57:       <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
 58:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
 59:           <span class="ruby-ivar">@topic</span>  = <span class="ruby-ivar">@forum</span>.<span class="ruby-identifier">topics</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 60:           <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">section_id</span> = <span class="ruby-identifier">section</span>.<span class="ruby-identifier">id</span>
 61:           <span class="ruby-identifier">assign_protected</span>
 62:           <span class="ruby-ivar">@post</span>   = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 63:           <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">topic</span>=<span class="ruby-ivar">@topic</span>
 64:           <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">user</span> = <span class="ruby-identifier">current_user</span>
 65:           <span class="ruby-comment cmt"># only save topic if post is valid so in the view topic will be a new record if there was an error</span>
 66:           <span class="ruby-comment cmt"># @topic.save! if @post.valid?</span>
 67:           <span class="ruby-comment cmt"># @post.save! </span>
 68:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">valid?</span>
 69:             <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">save</span>
 70:             <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">save</span>
 71:           <span class="ruby-keyword kw">else</span>
 72:             <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Information invalid or missing&quot;</span>
 73:             <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:new</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
 74:           <span class="ruby-keyword kw">end</span>
 75:         <span class="ruby-keyword kw">end</span>
 76:       <span class="ruby-keyword kw">end</span>
 77:     <span class="ruby-keyword kw">else</span>
 78:       <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
 79:         <span class="ruby-ivar">@topic</span>  = <span class="ruby-ivar">@forum</span>.<span class="ruby-identifier">topics</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 80:         <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">section_id</span> = <span class="ruby-identifier">cur_section_id</span>
 81:         <span class="ruby-identifier">assign_protected</span>
 82:         <span class="ruby-ivar">@post</span>   = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 83:         <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">topic</span>=<span class="ruby-ivar">@topic</span>
 84:         <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">user</span> = <span class="ruby-identifier">current_user</span>
 85:         <span class="ruby-comment cmt"># only save topic if post is valid so in the view topic will be a new record if there was an error</span>
 86:         <span class="ruby-comment cmt"># @topic.save! if @post.valid?</span>
 87:         <span class="ruby-comment cmt"># @post.save! </span>
 88:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">valid?</span>
 89:           <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">save</span>
 90:           <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">save</span>
 91:         <span class="ruby-keyword kw">else</span>
 92:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Information invalid or missing&quot;</span>
 93:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:new</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
 94:         <span class="ruby-keyword kw">end</span>
 95:       <span class="ruby-keyword kw">end</span>
 96:     <span class="ruby-keyword kw">end</span>
 97:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
 98:        <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:index</span>, <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:discussion</span> }
 99:       <span class="ruby-comment cmt"># format.xml  { head :created, :location =&gt; formatted_topic_url(:forum_id =&gt; @forum, :id =&gt; @topic, :format =&gt; :xml) }</span>
100:     <span class="ruby-keyword kw">end</span>
101:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000107" class="method-detail">
        <a name="M000107"></a>

        <div class="method-heading">
          <a href="#M000107" class="method-signature">
          <span class="method-name">destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deletes topic and all associated posts.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000107-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 114</span>
114:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>
115:     <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">destroy</span>
116:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-node">&quot;Topic '#{@topic.title}' was deleted.&quot;</span>
117:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
118:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">home_path</span> }
119:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-value">200</span> }
120:     <span class="ruby-keyword kw">end</span>
121:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000102" class="method-detail">
        <a name="M000102"></a>

        <div class="method-heading">
          <a href="#M000102" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Shows all the current topics for the forum - (Discussion). Only admins can
<a href="DiscussionController.html#M000105">create</a> <a
href="DiscussionController.html#M000103">new</a> topics.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000102-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000102-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 14</span>
14:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
15:     <span class="ruby-identifier">conditions</span> = <span class="ruby-node">&quot;section_id = #{current_user.course.section.id}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">admin?</span>
16:     <span class="ruby-ivar">@topics</span> = <span class="ruby-ivar">@forum</span>.<span class="ruby-identifier">topics</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;created_at DESC&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conditions</span>)
17:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000103" class="method-detail">
        <a name="M000103"></a>

        <div class="method-heading">
          <a href="#M000103" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Page for inputing data for <a
href="DiscussionController.html#M000103">new</a> topic.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000103-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000103-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 20</span>
20:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
21:     <span class="ruby-ivar">@topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">new</span>
22:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="#M000104" class="method-signature">
          <span class="method-name">show</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="DiscussionController.html#M000104">show</a> all posts for a
particular topic. Posts are paginated at 15 posts per page. Beast
implemented a rss version, but this is unused as of now.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000104-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 25</span>
25:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>
26:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
27:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-keyword kw">do</span>
28:         <span class="ruby-comment cmt"># see notes in application.rb on how this works</span>
29:         <span class="ruby-identifier">update_last_seen_at</span>
30:         <span class="ruby-comment cmt"># keep track of when we last viewed this topic for activity indicators</span>
31:         <span class="ruby-comment cmt"># (session[:topics] ||= {})[@topic.id] = Time.now.utc</span>
32:         <span class="ruby-comment cmt"># authors of topics don't get counted towards total hits</span>
33:         <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">hit!</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">logged_in?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>
34:         
35:         <span class="ruby-ivar">@post_pages</span>, <span class="ruby-ivar">@posts</span> = <span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">:posts</span>, <span class="ruby-identifier">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">15</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'posts.created_at'</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:user</span>,
36:                               <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'posts.topic_id = ?'</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]])
37:         <span class="ruby-ivar">@post</span>   = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>
38:       <span class="ruby-keyword kw">end</span>
39:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span> <span class="ruby-keyword kw">do</span>
40:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">to_xml</span>
41:       <span class="ruby-keyword kw">end</span>
42:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">rss</span> <span class="ruby-keyword kw">do</span>
43:         <span class="ruby-ivar">@posts</span> = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'created_at desc'</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">15</span>)
44:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'show.rxml'</span>, <span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
45:       <span class="ruby-keyword kw">end</span>
46:     <span class="ruby-keyword kw">end</span>
47:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Allows for updating of topic attributes. I don&#8216;t believe this is used
anywhere.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 103</span>
103:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
104:     <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>]
105:     <span class="ruby-identifier">assign_protected</span>
106:     <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">save!</span>
107:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
108:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:show</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@topic</span> }
109:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-value">200</span> }
110:     <span class="ruby-keyword kw">end</span>
111:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000108" class="method-detail">
        <a name="M000108"></a>

        <div class="method-heading">
          <a href="#M000108" class="method-signature">
          <span class="method-name">assign_protected</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used in the <a href="DiscussionController.html#M000105">create</a> method,
this assigns attributes to the topic that should not be accessible to the
view - i.e. user, sticky, and forum_id
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000108-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 127</span>
127:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assign_protected</span>
128:       <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">user</span>     = <span class="ruby-identifier">current_user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">new_record?</span>
129:       <span class="ruby-comment cmt"># admins and moderators can sticky and lock topics</span>
130:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">admin?</span>
131:       <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">sticky</span>, <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">locked</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>][<span class="ruby-identifier">:sticky</span>], <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>][<span class="ruby-identifier">:locked</span>] 
132:       <span class="ruby-comment cmt"># only admins can move</span>
133:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">admin?</span>
134:       <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">forum_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>][<span class="ruby-identifier">:forum_id</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>][<span class="ruby-identifier">:forum_id</span>]
135:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="#M000111" class="method-signature">
          <span class="method-name">block_locked</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If the current semester is locked, then return to <a
href="DiscussionController.html#M000102">index</a>. Used as a before filter
on everything except <a href="DiscussionController.html#M000102">index</a>
and <a href="DiscussionController.html#M000104">show</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000111-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 149</span>
149:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">block_locked</span>
150:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:index</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@semester</span>.<span class="ruby-identifier">locked?</span>
151:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000109" class="method-detail">
        <a name="M000109"></a>

        <div class="method-heading">
          <a href="#M000109" class="method-signature">
          <span class="method-name">find_forum_and_topic</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finds the forum (which should always be the discussion for the particular
semester) and topic (if using the <a
href="DiscussionController.html#M000104">show</a> method) and assigns them
to the variables @forum and @topic
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000109-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 138</span>
138:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_forum_and_topic</span>
139:       <span class="ruby-ivar">@forum</span> = <span class="ruby-ivar">@semester</span>.<span class="ruby-identifier">forums</span>.<span class="ruby-identifier">find_discussion</span>
140:       <span class="ruby-ivar">@topic</span> = <span class="ruby-ivar">@forum</span>.<span class="ruby-identifier">topics</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
141:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="#M000110" class="method-signature">
          <span class="method-name">redirect_if_not_right_topic</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns to the <a href="DiscussionController.html#M000102">index</a> if
student tries to access a topic that is in the wrong section. Used as a
before filter
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000110-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/discussion_controller.rb, line 144</span>
144:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect_if_not_right_topic</span>
145:       <span class="ruby-identifier">redirect_to</span>( <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:index</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">admin?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">section</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">section_id</span>
146:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>