<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: GalleryController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">GalleryController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/gallery_controller_rb.html">
                app/controllers/gallery_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This controller manages the gallery forum.
</p>
<p>
Both the Gallery and the Discussion utilize the same underlying
classes(models): topics and posts. In the Gallery controller, topics
represent an image with the associated info with it. Gallery acts as a
single forum. It can have multiple topics(pictures) and each topic has
multiple posts.
</p>
<p>
Much of this and topics and posts are brought over from Beast
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000057">assign_protected</a>&nbsp;&nbsp;
      <a href="#M000061">block_locked</a>&nbsp;&nbsp;
      <a href="#M000053">create</a>&nbsp;&nbsp;
      <a href="#M000055">destroy</a>&nbsp;&nbsp;
      <a href="#M000058">find_forum_and_topic</a>&nbsp;&nbsp;
      <a href="#M000050">index</a>&nbsp;&nbsp;
      <a href="#M000051">new</a>&nbsp;&nbsp;
      <a href="#M000059">redirect_if_not_right_topic</a>&nbsp;&nbsp;
      <a href="#M000060">set_layout</a>&nbsp;&nbsp;
      <a href="#M000052">show</a>&nbsp;&nbsp;
      <a href="#M000056">show_image</a>&nbsp;&nbsp;
      <a href="#M000054">update</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000053" class="method-detail">
        <a name="M000053"></a>

        <div class="method-heading">
          <a href="#M000053" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Actually creates the <a href="GalleryController.html#M000051">new</a>
topic. In the <a href="GalleryController.html#M000051">new</a> topic page,
theere is a drop down menu for which section the topic should be made for.
Each topic has a section associated with it so as to limit visibility of
the topics based on sections which is in turn based on courses. If that
section to make a topic for comes back as -1, then a <a
href="GalleryController.html#M000051">new</a> topic will be made for all
sections of the semester. This is performed in the first part of the
function. If the section is not -1, then a topic is only created for one
specific section.
</p>
<p>
A topic only has a title, it also requires that a post be created at the
same time which contains the content of the topic. That is why the
transaction is used, so that the topic is created only if the post is a
valid one.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000053-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000053-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 51</span>
 51:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>  
 52:     <span class="ruby-identifier">cur_section_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;section_id&quot;</span>)
 53:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cur_section_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">-1</span>
 54:       <span class="ruby-identifier">sections</span> = <span class="ruby-ivar">@semester</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)
 55:       <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
 56:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
 57:           <span class="ruby-ivar">@topic</span>  = <span class="ruby-ivar">@forum</span>.<span class="ruby-identifier">topics</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 58:           <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">section_id</span> = <span class="ruby-identifier">section</span>.<span class="ruby-identifier">id</span>
 59:           <span class="ruby-identifier">assign_protected</span>
 60:           <span class="ruby-ivar">@post</span>   = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 61:           <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">topic</span>=<span class="ruby-ivar">@topic</span>
 62:           <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">user</span> = <span class="ruby-identifier">current_user</span>
 63: 
 64:           <span class="ruby-ivar">@image</span> = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">build_image</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 65:           <span class="ruby-ivar">@image</span>.<span class="ruby-identifier">topic_id</span> = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">id</span>
 66:           <span class="ruby-ivar">@image</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>
 67:           <span class="ruby-comment cmt"># only save topic if post is valid so in the view topic will be a new record if there was an error</span>
 68:           <span class="ruby-comment cmt"># @topic.save! if @post.valid?</span>
 69:           <span class="ruby-comment cmt"># @post.save! </span>
 70:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">valid?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-ivar">@image</span>.<span class="ruby-identifier">valid?</span>
 71:             <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">save</span>
 72:             <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">save</span>
 73:             <span class="ruby-ivar">@image</span>.<span class="ruby-identifier">save</span>
 74:           <span class="ruby-keyword kw">else</span>
 75:             <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Information invalid or missing&quot;</span>
 76:             <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:new</span>, <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;gallery&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
 77:           <span class="ruby-keyword kw">end</span>
 78:         <span class="ruby-keyword kw">end</span>
 79:       <span class="ruby-keyword kw">end</span>
 80:       <span class="ruby-keyword kw">else</span>
 81:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
 82:           <span class="ruby-ivar">@topic</span>  = <span class="ruby-ivar">@forum</span>.<span class="ruby-identifier">topics</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 83:           <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">section_id</span> = <span class="ruby-identifier">cur_section_id</span>
 84:           <span class="ruby-identifier">assign_protected</span>
 85:           <span class="ruby-ivar">@post</span>   = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 86:           <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">topic</span>=<span class="ruby-ivar">@topic</span>
 87:           <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">user</span> = <span class="ruby-identifier">current_user</span>
 88: 
 89:           <span class="ruby-ivar">@image</span> = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">build_image</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>])
 90:           <span class="ruby-ivar">@image</span>.<span class="ruby-identifier">topic_id</span> = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">id</span>
 91:           <span class="ruby-ivar">@image</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>
 92:           <span class="ruby-comment cmt"># only save topic if post is valid so in the view topic will be a new record if there was an error</span>
 93:           <span class="ruby-comment cmt"># @topic.save! if @post.valid?</span>
 94:           <span class="ruby-comment cmt"># @post.save! </span>
 95:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">valid?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-ivar">@image</span>.<span class="ruby-identifier">valid?</span>
 96:             <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">save</span>
 97:             <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">save</span>
 98:             <span class="ruby-ivar">@image</span>.<span class="ruby-identifier">save</span>
 99:           <span class="ruby-keyword kw">else</span>
100:             <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Information invalid or missing&quot;</span>
101:             <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:new</span>, <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;gallery&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
102:           <span class="ruby-keyword kw">end</span>
103:         <span class="ruby-keyword kw">end</span>
104:         
105:       <span class="ruby-keyword kw">end</span>
106:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
107:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:index</span>, <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:gallery</span> }
108:       <span class="ruby-comment cmt"># format.xml  { head :created, :location =&gt; formatted_topic_url(:forum_id =&gt; @forum, :id =&gt; @topic, :format =&gt; :xml) }</span>
109:     <span class="ruby-keyword kw">end</span>
110:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000055" class="method-detail">
        <a name="M000055"></a>

        <div class="method-heading">
          <a href="#M000055" class="method-signature">
          <span class="method-name">destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deletes topic and all associated posts for that topic
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000055-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000055-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 124</span>
124:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>
125:     <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">destroy</span>
126:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-node">&quot;Topic '#{@topic.title}' was deleted.&quot;</span>
127:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
128:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:gallery</span>, <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:index</span> }
129:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-value">200</span> }
130:     <span class="ruby-keyword kw">end</span>
131:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000050" class="method-detail">
        <a name="M000050"></a>

        <div class="method-heading">
          <a href="#M000050" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Display all the images and associated titles for all topics
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000050-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000050-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 15</span>
15:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
16:     <span class="ruby-identifier">conditions</span> = <span class="ruby-node">&quot;section_id = #{current_user.course.section.id}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">admin?</span>
17:     <span class="ruby-ivar">@topics</span> = <span class="ruby-ivar">@forum</span>.<span class="ruby-identifier">topics</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;created_at DESC&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conditions</span>)
18:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000051" class="method-detail">
        <a name="M000051"></a>

        <div class="method-heading">
          <a href="#M000051" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Displays view to <a href="GalleryController.html#M000053">create</a> <a
href="GalleryController.html#M000051">new</a> topic for gallery
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000051-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000051-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 21</span>
21:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
22:     <span class="ruby-ivar">@topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">new</span>
23:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000052" class="method-detail">
        <a name="M000052"></a>

        <div class="method-heading">
          <a href="#M000052" class="method-signature">
          <span class="method-name">show</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="GalleryController.html#M000052">show</a> all posts for a
particular topic. Posts are paginated at 15 posts per page. Beast
implemented a rss version, but this is unused as of now.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000052-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000052-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 26</span>
26:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>
27:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
28:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-keyword kw">do</span>
29:         <span class="ruby-comment cmt"># see notes in application.rb on how this works</span>
30:         <span class="ruby-identifier">update_last_seen_at</span>
31:         <span class="ruby-comment cmt"># keep track of when we last viewed this topic for activity indicators</span>
32:         <span class="ruby-comment cmt"># (session[:topics] ||= {})[@topic.id] = Time.now.utc</span>
33:         <span class="ruby-comment cmt"># authors of topics don't get counted towards total hits</span>
34:         <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">hit!</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">logged_in?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>
35:         <span class="ruby-ivar">@post_pages</span>, <span class="ruby-ivar">@posts</span> = <span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">:posts</span>, <span class="ruby-identifier">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">15</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'posts.created_at'</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:user</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'posts.topic_id = ?'</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]])
36:         <span class="ruby-ivar">@post</span>   = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>
37:       <span class="ruby-keyword kw">end</span>
38:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span> <span class="ruby-keyword kw">do</span>
39:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">to_xml</span>
40:       <span class="ruby-keyword kw">end</span>
41:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">rss</span> <span class="ruby-keyword kw">do</span>
42:         <span class="ruby-ivar">@posts</span> = <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'created_at desc'</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">25</span>)
43:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'show.rxml'</span>, <span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
44:       <span class="ruby-keyword kw">end</span>
45:     <span class="ruby-keyword kw">end</span>
46:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000056" class="method-detail">
        <a name="M000056"></a>

        <div class="method-heading">
          <a href="#M000056" class="method-signature">
          <span class="method-name">show_image</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000056-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000056-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 133</span>
133:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show_image</span>
134:     
135:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000054" class="method-detail">
        <a name="M000054"></a>

        <div class="method-heading">
          <a href="#M000054" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Allow edit of topic attributes. Probably not used.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000054-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000054-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 113</span>
113:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
114:     <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>]
115:     <span class="ruby-identifier">assign_protected</span>
116:     <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">save!</span>
117:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
118:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:show</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@topic</span> }
119:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-value">200</span> }
120:     <span class="ruby-keyword kw">end</span>
121:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000057" class="method-detail">
        <a name="M000057"></a>

        <div class="method-heading">
          <a href="#M000057" class="method-signature">
          <span class="method-name">assign_protected</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used in the <a href="GalleryController.html#M000053">create</a> method,
this assigns attributes to the topic that should not be accessible to the
view - i.e. user, sticky, and forum_id
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000057-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000057-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 141</span>
141:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assign_protected</span>
142:       <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">user</span>     = <span class="ruby-identifier">current_user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">new_record?</span>
143:       <span class="ruby-comment cmt"># admins and moderators can sticky and lock topics</span>
144:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">admin?</span>
145:       <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">sticky</span>, <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">locked</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>][<span class="ruby-identifier">:sticky</span>], <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>][<span class="ruby-identifier">:locked</span>] 
146:       <span class="ruby-comment cmt"># only admins can move</span>
147:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">admin?</span>
148:       <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">forum_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>][<span class="ruby-identifier">:forum_id</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>][<span class="ruby-identifier">:forum_id</span>]
149:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000061" class="method-detail">
        <a name="M000061"></a>

        <div class="method-heading">
          <a href="#M000061" class="method-signature">
          <span class="method-name">block_locked</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If the current semester is locked, then return to <a
href="GalleryController.html#M000050">index</a>. Used as a before filter on
everything except <a href="GalleryController.html#M000050">index</a> and <a
href="GalleryController.html#M000052">show</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000061-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000061-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 172</span>
172:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">block_locked</span>
173:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:index</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@semester</span>.<span class="ruby-identifier">locked?</span>
174:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000058" class="method-detail">
        <a name="M000058"></a>

        <div class="method-heading">
          <a href="#M000058" class="method-signature">
          <span class="method-name">find_forum_and_topic</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finds the forum (which should always be the discussion for the particular
semester) and topic (if using the <a
href="GalleryController.html#M000052">show</a> method) and assigns them to
the variables @forum and @topic
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000058-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000058-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 152</span>
152:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_forum_and_topic</span>
153:       <span class="ruby-ivar">@forum</span> = <span class="ruby-ivar">@semester</span>.<span class="ruby-identifier">forums</span>.<span class="ruby-identifier">find_photo</span>
154:       <span class="ruby-ivar">@topic</span> = <span class="ruby-ivar">@forum</span>.<span class="ruby-identifier">topics</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
155:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000059" class="method-detail">
        <a name="M000059"></a>

        <div class="method-heading">
          <a href="#M000059" class="method-signature">
          <span class="method-name">redirect_if_not_right_topic</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns to the <a href="GalleryController.html#M000050">index</a> if
student tries to access a topic that is in the wrong section. Used as a
before filter
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000059-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000059-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 158</span>
158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect_if_not_right_topic</span>
159:       <span class="ruby-identifier">redirect_to</span>( <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:index</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">admin?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">course</span>.<span class="ruby-identifier">section</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@topic</span>.<span class="ruby-identifier">section_id</span>
160:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000060" class="method-detail">
        <a name="M000060"></a>

        <div class="method-heading">
          <a href="#M000060" class="method-signature">
          <span class="method-name">set_layout</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
sets layout to display
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000060-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000060-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/gallery_controller.rb, line 163</span>
163:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_layout</span>  
164:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">admin?</span>
165:        <span class="ruby-identifier">render</span> <span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'admin'</span>
166:       <span class="ruby-keyword kw">else</span>
167:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'application'</span>
168:       <span class="ruby-keyword kw">end</span>
169:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>